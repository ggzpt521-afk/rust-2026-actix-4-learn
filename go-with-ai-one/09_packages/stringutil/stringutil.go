// ============================================================================
// Package stringutil 提供字符串工具函数
// ============================================================================
// 这是一个示例包，展示如何创建实用的字符串处理工具
//
// 【包的作用】
// 封装常用的字符串操作函数，补充标准库 strings 包的功能
//
// 【导入方式】
// import "example.com/packages/stringutil"
// 使用：stringutil.Reverse("hello")
//
// 【本文件学习目标】
// 1. 学习如何处理 Unicode 字符串
// 2. 理解 rune 和 byte 的区别
// 3. 掌握字符串操作的常用模式
// 4. 了解如何封装标准库功能
//
// 【字符串处理要点】
// - Go 字符串是 UTF-8 编码的字节序列
// - 一个中文字符占 3 字节
// - 使用 []rune 转换可以正确处理 Unicode
// ============================================================================
package stringutil

import (
	"strings"
	"unicode"
)

// ============================================================================
// 【字符串反转】
// ============================================================================
// 正确处理 Unicode 字符的反转
//
// 【为什么要用 []rune？】
// - string 的索引操作返回 byte，不是字符
// - 中文等 Unicode 字符占多个字节
// - []rune 将字符串转换为 Unicode 码点数组
// - 每个 rune 是一个完整的 Unicode 字符
//
// 【示例】
// "Hello" -> "olleH"
// "你好" -> "好你"
// ============================================================================

// Reverse 反转字符串
// 正确处理包含中文等多字节字符的字符串
func Reverse(s string) string {
	runes := []rune(s) // 转换为 rune 切片，正确处理 Unicode
	// 双指针交换
	for i, j := 0, len(runes)-1; i < j; i, j = i+1, j-1 {
		runes[i], runes[j] = runes[j], runes[i] // Go 支持同时赋值
	}
	return string(runes) // 转回字符串
}

// ============================================================================
// 【回文判断】
// ============================================================================
// 回文是正读和反读都一样的字符串
// 如：radar, level, 上海自来水来自海上
// ============================================================================

// IsPalindrome 判断是否为回文
// 忽略大小写进行比较
func IsPalindrome(s string) bool {
	s = strings.ToLower(s) // 转换为小写
	return s == Reverse(s) // 与反转后的字符串比较
}

// ============================================================================
// 【字符串转换】
// ============================================================================

// Capitalize 将首字母大写
// 正确处理 Unicode 首字符
//
// 【示例】
// "hello" -> "Hello"
// "中文" -> "中文"（中文无大写概念）
func Capitalize(s string) string {
	if s == "" {
		return s // 空字符串直接返回
	}
	runes := []rune(s)
	runes[0] = unicode.ToUpper(runes[0]) // 将第一个 rune 转为大写
	return string(runes)
}

// ============================================================================
// 【字符串统计】
// ============================================================================

// WordCount 统计单词数量
// 使用 strings.Fields 按空白字符分割
//
// 【strings.Fields 的行为】
// - 按空白字符（空格、制表符、换行等）分割
// - 自动处理连续空白
// - 返回切片，len 即为单词数
func WordCount(s string) int {
	return len(strings.Fields(s))
}

// CountChar 统计字符出现次数
// 正确处理 Unicode 字符
//
// 【参数】
// s: 要搜索的字符串
// ch: 要统计的字符（rune 类型）
func CountChar(s string, ch rune) int {
	count := 0
	for _, c := range s { // range 遍历字符串返回 rune
		if c == ch {
			count++
		}
	}
	return count
}

// ============================================================================
// 【字符串截断】
// ============================================================================

// Truncate 截断字符串到指定长度
// 超过长度时添加 "..." 后缀
//
// 【参数】
// s: 原字符串
// maxLen: 最大长度（按字符计算，不是字节）
//
// 【示例】
// Truncate("Hello World", 8) -> "Hello..."
// Truncate("Hi", 8) -> "Hi"
func Truncate(s string, maxLen int) string {
	runes := []rune(s)
	if len(runes) <= maxLen {
		return s // 不需要截断
	}
	if maxLen <= 3 {
		return string(runes[:maxLen]) // 太短，直接截断
	}
	// 截断并添加省略号
	return string(runes[:maxLen-3]) + "..."
}

// ============================================================================
// 【字符串搜索】
// ============================================================================

// ContainsIgnoreCase 检查字符串是否包含子串（忽略大小写）
// 注意：函数名用 Contains 前缀而不是 Is 前缀
// 因为它不是返回属性，而是执行搜索
func ContainsIgnoreCase(s, substr string) bool {
	return strings.Contains(
		strings.ToLower(s),      // 主字符串转小写
		strings.ToLower(substr), // 子串转小写
	)
}

// ============================================================================
// 【字符串清理】
// ============================================================================

// RemoveSpaces 移除所有空格
// 使用 strings.ReplaceAll 进行替换
func RemoveSpaces(s string) string {
	return strings.ReplaceAll(s, " ", "")
}

// IsBlank 判断字符串是否为空或只包含空白字符
//
// 【空白字符包括】
// - 空格 ' '
// - 制表符 '\t'
// - 换行符 '\n'
// - 回车符 '\r'
// 等等...
func IsBlank(s string) bool {
	return strings.TrimSpace(s) == "" // TrimSpace 移除首尾空白
}

// ============================================================================
// 【字符串生成】
// ============================================================================

// Repeat 重复字符串 n 次
// 直接封装 strings.Repeat
//
// 【示例】
// Repeat("ab", 3) -> "ababab"
// Repeat("x", 0) -> ""
func Repeat(s string, n int) string {
	return strings.Repeat(s, n)
}
