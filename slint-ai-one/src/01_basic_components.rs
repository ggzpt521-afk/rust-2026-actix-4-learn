// ============================================================================
// 01_basic_components.rs - Slint 基础组件示例
// ============================================================================
//
// 【核心概念】
// 这个示例展示了 Slint UI 框架的最基本用法：
// 1. 如何使用 slint::slint! 宏定义 UI 组件
// 2. 如何创建窗口和基础元素
// 3. 如何在 Rust 中启动 Slint 应用
//
// 【原理说明】
// Slint 是一个声明式 UI 框架，UI 定义和业务逻辑分离：
// - UI 部分使用 Slint 的 DSL (领域特定语言) 描述
// - 业务逻辑使用 Rust 代码实现
// - slint::slint! 宏在编译时将 Slint DSL 转换为 Rust 代码
// ============================================================================

// ----------------------------------------------------------------------------
// slint::slint! 宏
// ----------------------------------------------------------------------------
// 这个宏是 Slint 的核心，它允许在 Rust 代码中内联定义 UI
// 宏在编译时解析 Slint DSL，生成对应的 Rust 结构体和方法
// 生成的代码包括：
// - 组件结构体 (如 BasicComponents)
// - new() 构造函数
// - run() 运行方法
// - 属性的 getter/setter 方法
slint::slint! {
    // ------------------------------------------------------------------------
    // export component - 导出组件声明
    // ------------------------------------------------------------------------
    // export: 表示这个组件可以从 Rust 代码中访问
    // component: 声明一个 Slint 组件
    // BasicComponents: 组件名称，会生成同名的 Rust 结构体
    // inherits Window: 继承自 Window，表示这是一个顶层窗口组件
    //
    // 【重要】在 Slint 1.x 中，所有顶层组件必须继承 Window
    // Window 提供了窗口的基本功能：标题栏、关闭按钮、调整大小等
    export component BasicComponents inherits Window {

        // --------------------------------------------------------------------
        // 窗口基本属性
        // --------------------------------------------------------------------
        // width/height: 设置窗口的初始大小
        // 单位说明：
        // - px: 物理像素 (实际屏幕像素)
        // - phx: 物理像素 (同 px)
        // - %: 相对于父元素的百分比
        // - rem: 相对于根元素字体大小
        width: 400px;   // 窗口宽度 400 像素
        height: 300px;  // 窗口高度 300 像素

        // title: Window 组件特有的属性，设置窗口标题栏文字
        title: "Basic Components";

        // --------------------------------------------------------------------
        // Rectangle - 矩形组件
        // --------------------------------------------------------------------
        // Rectangle 是 Slint 中最基础的可视化元素
        // 它是一个矩形区域，可以设置背景色、边框、圆角等
        // 常用作容器或背景
        Rectangle {
            // background: 设置背景颜色
            // 颜色格式支持：
            // - #RRGGBB: 6位十六进制 (如 #f0f0f0)
            // - #RRGGBBAA: 8位十六进制带透明度
            // - rgb(r, g, b): RGB 函数
            // - rgba(r, g, b, a): RGBA 函数
            // - 颜色名称: red, blue, white, transparent 等
            background: #f0f0f0;  // 浅灰色背景

            // ----------------------------------------------------------------
            // Text - 文本组件
            // ----------------------------------------------------------------
            // Text 用于显示文本内容，是最常用的组件之一
            Text {
                // text: 要显示的文本内容
                // 支持字符串字面量和属性绑定
                text: "Hello Slint";

                // font-size: 字体大小
                // 常用单位：px (像素), pt (点), rem (相对单位)
                font-size: 24px;

                // x, y: 元素的位置坐标
                // 相对于父元素的左上角
                // 注意：使用绝对定位时，元素不会参与布局计算
                x: 100px;  // 距左边 100 像素
                y: 100px;  // 距顶部 100 像素

                // 【其他常用 Text 属性】
                // color: 文字颜色
                // font-weight: 字体粗细 (100-900 或 normal/bold)
                // font-family: 字体族
                // horizontal-alignment: 水平对齐 (left/center/right)
                // vertical-alignment: 垂直对齐 (top/center/bottom)
                // overflow: 文本溢出处理 (clip/elide)
            }
        }
    }
}

// ============================================================================
// main 函数 - 程序入口
// ============================================================================
fn main() {
    // ------------------------------------------------------------------------
    // 创建组件实例
    // ------------------------------------------------------------------------
    // BasicComponents::new() 返回 Result<BasicComponents, PlatformError>
    //
    // 【原理说明】
    // new() 方法执行以下操作：
    // 1. 初始化 Slint 运行时 (如果尚未初始化)
    // 2. 选择合适的后端渲染器 (OpenGL, Skia, 或软件渲染)
    // 3. 创建组件实例并初始化所有属性
    // 4. 返回组件实例或错误
    //
    // unwrap(): 如果 Result 是 Err，程序会 panic
    // 在生产代码中，建议使用 ? 运算符或 match 处理错误
    let app = BasicComponents::new().unwrap();

    // ------------------------------------------------------------------------
    // 运行应用
    // ------------------------------------------------------------------------
    // run() 方法启动事件循环，显示窗口并处理用户交互
    //
    // 【原理说明】
    // run() 方法执行以下操作：
    // 1. 创建原生窗口 (使用 winit 库)
    // 2. 初始化渲染上下文
    // 3. 进入事件循环：
    //    - 处理窗口事件 (鼠标、键盘、调整大小等)
    //    - 更新组件状态
    //    - 重绘 UI
    // 4. 用户关闭窗口时，退出循环并返回
    //
    // run() 是阻塞的，直到窗口关闭才会返回
    app.run().unwrap();
}

// ============================================================================
// 【知识点总结】
// ============================================================================
//
// 1. Slint 架构
//    - 声明式 UI：用 DSL 描述"是什么"，而非"怎么做"
//    - 编译时代码生成：slint! 宏在编译时生成 Rust 代码
//    - 跨平台：支持 Windows、macOS、Linux、嵌入式
//
// 2. 组件层次
//    - Window: 顶层窗口，必须被继承
//    - Rectangle: 基础容器/背景
//    - Text: 文本显示
//
// 3. 属性系统
//    - 使用 key: value 语法设置属性
//    - 支持多种单位：px, %, rem 等
//    - 支持颜色、数字、字符串等类型
//
// 4. Rust 集成
//    - slint! 宏生成 Rust 结构体
//    - new() 创建实例
//    - run() 启动事件循环
// ============================================================================
