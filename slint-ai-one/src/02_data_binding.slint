// ============================================================================
// 02_data_binding.slint - Slint 数据绑定示例
// ============================================================================
//
// 【文件说明】
// 本文件演示 Slint 的核心特性：数据绑定
// 数据绑定是连接 UI 和数据的桥梁，是响应式 UI 的基础
//
// 【与 .rs 文件的关联】
// - 属性（property）是 .slint 和 .rs 通信的主要方式
// - export 组件的属性会生成 Rust getter/setter 方法
// - 属性名中的 - 在 Rust 中变为 _
//   例如：user-name → get_user_name() / set_user_name()
//
// 【数据绑定原理】
// Slint 使用响应式属性系统：
// 1. 每个属性都有一个当前值
// 2. 当属性值变化时，所有依赖它的 UI 元素自动更新
// 3. 这是通过依赖追踪实现的（类似 Vue 的响应式系统）
//
// 【绑定类型】
// - 单向绑定：属性 → UI（属性变化时 UI 更新）
// - 双向绑定：属性 ↔ UI（双方都可以修改）
// - 表达式绑定：基于多个属性计算（自动重新计算）
// ============================================================================

// ============================================================================
// 组件声明
// ============================================================================
// 注意：此文件中的语法是 Slint 0.x 版本
// Slint 1.x 中：
// - on-text-changed 改为 edited =>
// - on-clicked 改为 clicked =>
// - counter -= 1 需要改为 counter = counter - 1
// - 顶级组件应 inherits Window
// ============================================================================
export component DataBinding {
    // 窗口尺寸
    width: 400px;
    height: 350px;

    // ========================================================================
    // 属性声明 - 数据绑定的核心
    // ========================================================================
    //
    // 【属性修饰符详解】
    //
    // in property: 输入属性
    //   - 组件内部：只读
    //   - 外部/Rust：可读可写
    //   - 用途：接收父组件或 Rust 传入的配置
    //
    // out property: 输出属性
    //   - 组件内部：可读可写
    //   - 外部/Rust：只读
    //   - 用途：向父组件或 Rust 暴露组件状态
    //
    // in-out property: 双向属性
    //   - 组件内部：可读可写
    //   - 外部/Rust：可读可写
    //   - 用途：双向数据同步（如表单数据）
    //
    // property（无修饰符）: 私有属性
    //   - 组件内部：可读可写
    //   - 外部/Rust：不可访问
    //   - 用途：组件内部状态
    //
    // 【Rust 中访问属性】
    // let app = DataBinding::new().unwrap();
    // let name = app.get_user_name();        // 获取属性
    // app.set_user_name("新名字".into());     // 设置属性
    // ========================================================================

    // in-out property: 双向绑定属性
    // <string>: 属性类型为字符串
    // "Guest": 默认值
    in-out property <string> user-name: "Guest";

    // 整数类型属性
    in-out property <int> counter: 0;

    // in property: 输入属性（外部可设置，内部只读）
    in property <string> app-title: "数据绑定示例";

    VerticalLayout {
        padding: 20px;
        spacing: 15px;

        // ====================================================================
        // 单向绑定：属性 → UI
        // ====================================================================
        // text: app-title 表示 Text 的 text 属性绑定到 app-title 属性
        // 当 app-title 变化时，Text 自动更新显示
        //
        // 【原理】
        // Slint 在编译时分析依赖关系：
        // Text.text 依赖于 app-title
        // 当 app-title 变化 → 触发 Text 重新渲染
        Text {
            text: app-title;                  // 绑定到 app-title 属性
            font-size: 24px;
            font-weight: bold;
            color: #333;
            horizontal-alignment: center;
        }

        // ====================================================================
        // 双向绑定：UI ↔ 属性
        // ====================================================================
        // 双向绑定需要两部分：
        // 1. text: user-name         → 属性到 UI
        // 2. on-text-changed: {...}  → UI 到属性
        //
        // 【注意】Slint 1.x 中语法变化：
        // on-text-changed: { } → edited => { }
        //
        // 【与 Rust 的交互】
        // Rust 代码可以随时修改 user-name：
        //   app.set_user_name("新用户".into());
        // UI 会自动更新显示
        HorizontalLayout {
            spacing: 10px;
            alignment: center;

            Text {
                text: "用户名:";
                font-size: 16px;
            }

            LineEdit {
                text: user-name;               // 属性 → UI（显示当前值）
                width: 200px;
                // 当输入变化时更新属性（UI → 属性）
                // 注意：Slint 1.x 中改为 edited => { user-name = self.text; }
                on-text-changed: { user-name = text; }
            }
        }

        // ====================================================================
        // 表达式绑定：基于其他属性计算
        // ====================================================================
        // text: "欢迎，" + user-name + "！"
        // 这是一个表达式绑定，text 的值是计算出来的
        //
        // 【原理】
        // 1. Slint 分析表达式，发现依赖 user-name
        // 2. 当 user-name 变化时，自动重新计算表达式
        // 3. 计算结果更新到 text 属性
        //
        // 【支持的表达式】
        // - 字符串拼接：+ 运算符
        // - 数学运算：+, -, *, /
        // - 条件表达式：condition ? value1 : value2
        // - 函数调用：custom-function()
        Text {
            text: "欢迎，" + user-name + "！"; // 字符串拼接表达式
            font-size: 18px;
            color: #0066cc;
            horizontal-alignment: center;
        }

        // ====================================================================
        // 数字属性绑定与事件处理
        // ====================================================================
        // 演示如何通过按钮修改数字属性
        //
        // 【注意】Slint 1.x 版本问题：
        // counter -= 1 可能被解析错误
        // 应该使用：counter = counter - 1（注意空格）
        HorizontalLayout {
            spacing: 15px;
            alignment: center;

            Button {
                text: "-";
                width: 40px;
                // 点击时减少计数
                // Slint 1.x: clicked => { counter = counter - 1; }
                on-clicked: { counter -= 1; }
            }

            // 数字属性绑定到 Text
            // counter 会自动转换为字符串显示
            Text {
                text: counter;                 // int → string 自动转换
                font-size: 20px;
                width: 60px;
                horizontal-alignment: center;
            }

            Button {
                text: "+";
                width: 40px;
                on-clicked: { counter += 1; }
            }
        }

        // ====================================================================
        // 条件绑定：根据属性值改变样式
        // ====================================================================
        // Slint 支持三元条件表达式：
        //   condition ? value_if_true : value_if_false
        //
        // 【嵌套条件】
        // if a then "A" else if b then "B" else "C"
        // 在 Slint 1.x 中使用三元运算符：
        //   a ? "A" : (b ? "B" : "C")
        //
        // 【原理】
        // 条件表达式也是响应式的：
        // 当 counter 变化 → 条件重新计算 → UI 更新
        Text {
            // 根据 counter 值显示不同文本
            // 这是 Slint 0.x 的 if-then-else 语法
            // Slint 1.x 使用三元运算符
            text: if counter > 0 then "计数器为正数"
                  else if counter < 0 then "计数器为负数"
                  else "计数器为零";
            font-size: 16px;
            // 根据 counter 值显示不同颜色
            color: if counter > 0 then #009900
                   else if counter < 0 then #cc0000
                   else #666;
            horizontal-alignment: center;
        }

        // ====================================================================
        // Slider 与属性双向绑定
        // ====================================================================
        // 演示 Slider 组件与属性的双向绑定
        //
        // 【工作原理】
        // 1. value: counter → Slider 显示 counter 的值
        // 2. on-value-changed → 用户拖动时更新 counter
        // 3. 由于 Text 也绑定了 counter，所以 Text 也会更新
        //
        // 【注意】Slint 1.x 中：
        // on-value-changed: { } → changed => { }
        Slider {
            width: 200px;
            value: counter;                    // 绑定到 counter
            // range 属性设置滑块范围
            // 语法：range: min, max;
            // 注意：Slint 1.x 使用 minimum 和 maximum 属性
            range: -10, 10;
            // 当滑块值变化时更新 counter
            on-value-changed: { counter = value; }
        }
    }
}

// ============================================================================
// 【知识点总结】
// ============================================================================
//
// 1. 属性类型
//    <string>  - 字符串
//    <int>     - 整数
//    <float>   - 浮点数
//    <bool>    - 布尔值
//    <color>   - 颜色
//    <length>  - 长度（px, %, pt）
//    <[T]>     - 数组
//
// 2. 属性修饰符
//    in        - 输入（外部写，内部读）
//    out       - 输出（内部写，外部读）
//    in-out    - 双向（都可读写）
//    无修饰符  - 私有（仅内部可访问）
//
// 3. 绑定类型
//    单向绑定：text: property-name;
//    双向绑定：text: property + on-changed 事件
//    表达式绑定：text: "前缀" + property + "后缀";
//    条件绑定：color: condition ? color1 : color2;
//
// 4. 与 Rust 的交互
//    获取：app.get_property_name()
//    设置：app.set_property_name(value)
//    属性名：kebab-case → snake_case
//
// 5. Slint 版本差异
//    0.x: on-clicked: { }, if-then-else
//    1.x: clicked => { }, 三元运算符
//
// 6. 响应式原理
//    - 属性变化 → 依赖追踪 → UI 自动更新
//    - 类似 Vue/React 的响应式系统
//    - 但在编译时分析，运行时更高效
// ============================================================================
