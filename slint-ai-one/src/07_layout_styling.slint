// ============================================================================
// 07_layout_styling.slint - Slint 布局与样式示例
// ============================================================================
//
// 【文件说明】
// 本文件演示 Slint 的布局系统和样式属性
// 布局决定元素位置，样式决定元素外观
//
// 【与 .rs 文件的关联】
// - 布局和样式是纯 UI 概念，不直接生成 Rust API
// - 但可以通过属性动态控制样式（如主题切换）
// - Rust 可以设置影响布局的属性值
//
// 【布局系统原理】
// Slint 使用约束求解布局：
// 1. 每个元素声明尺寸约束（width, height, min-*, max-*）
// 2. 布局容器根据约束分配空间
// 3. stretch 属性控制剩余空间分配
// 4. 自动处理尺寸计算，无需手动定位
//
// 【样式系统】
// - 直接设置属性（background, color 等）
// - 不支持 CSS 类或全局样式表
// - 通过组件封装复用样式
// ============================================================================

// ============================================================================
// 全局样式变量（Slint 0.x 语法）
// ============================================================================
// @global-styles: 定义全局变量
//
// 【注意】
// 这是 Slint 0.x 的实验性功能
// Slint 1.x 推荐使用 global 组件定义共享值
//
// 【Slint 1.x 推荐方式】
// global Theme {
//     in-out property <color> primary-color: #0066cc;
//     in-out property <color> text-color: #333333;
// }
// 然后使用：Theme.primary-color
@global-styles {
    // 颜色变量
    --primary-color: #0066cc;
    --secondary-color: #009900;
    --warning-color: #ff9900;
    --danger-color: #cc0000;
    --text-color: #333333;
    --text-light: #666666;
    --bg-color: #ffffff;
    --bg-light: #f5f5f5;
    --border-color: #e0e0e0;

    // 间距变量
    --spacing-small: 8px;
    --spacing-medium: 16px;
    --spacing-large: 24px;

    // 圆角变量
    --radius-small: 4px;
    --radius-medium: 8px;
    --radius-large: 16px;
}

// ============================================================================
// 主应用组件
// ============================================================================
export component LayoutStyling {
    width: 600px;
    height: 600px;

    // 选项卡状态
    in-out property <int> active-tab: 0;

    VerticalLayout {
        // 使用变量设置间距
        padding: var(--spacing-medium);
        spacing: var(--spacing-medium);

        Text {
            text: "布局与样式示例";
            font-size: 24px;
            font-weight: bold;
            color: var(--text-color);
            horizontal-alignment: center;
        }

        // ====================================================================
        // 选项卡导航 - 动态生成
        // ====================================================================
        // 使用 for-in 循环生成选项卡按钮
        HorizontalLayout {
            spacing: var(--spacing-small);
            alignment: center;

            // 遍历字符串数组生成按钮
            // (index, name): 同时获取索引和值
            for (index, name) in ["水平布局", "垂直布局", "网格布局", "堆叠布局", "样式演示"]: {
                Button {
                    text: name;
                    // 根据 active-tab 设置激活样式
                    background: active-tab == index ? var(--primary-color) : var(--bg-light);
                    color: active-tab == index ? white : var(--text-color);
                    padding: var(--spacing-small) var(--spacing-medium);
                    border-radius: var(--radius-small);
                    on-clicked: { active-tab = index; }
                }
            }
        }

        // 内容区域
        Rectangle {
            width: 100%;
            height: 450px;
            background: var(--bg-light);
            border-radius: var(--radius-medium);
            border: 1px solid var(--border-color);
            padding: var(--spacing-medium);

            // ================================================================
            // 水平布局演示
            // ================================================================
            // HorizontalLayout: 水平排列子元素
            //
            // 【关键属性】
            // - spacing: 子元素间距
            // - padding: 内边距
            // - alignment: 子元素对齐（start, center, end, stretch）
            //
            // 【拉伸因子 stretch】
            // stretch: n 表示占用 n 份剩余空间
            // 多个元素的 stretch 值决定空间分配比例
            if active-tab == 0: {
                HorizontalLayout {
                    spacing: var(--spacing-medium);
                    padding: var(--spacing-medium);

                    // 固定宽度元素
                    Rectangle {
                        width: 100px;         // 固定宽度
                        height: 100px;
                        background: var(--primary-color);
                        border-radius: var(--radius-medium);
                        min-width: 80px;      // 最小宽度约束

                        Text {
                            text: "固定宽度";
                            color: white;
                            font-size: 12px;
                            vertical-alignment: center;
                            horizontal-alignment: center;
                        }
                    }

                    // 拉伸元素（占 1 份）
                    Rectangle {
                        height: 100px;
                        background: var(--secondary-color);
                        border-radius: var(--radius-medium);
                        // stretch: 拉伸因子
                        // 占用剩余空间的 1/(1+2) = 1/3
                        stretch: 1;

                        Text {
                            text: "拉伸因子 1";
                            color: white;
                            font-size: 12px;
                            vertical-alignment: center;
                            horizontal-alignment: center;
                        }
                    }

                    // 拉伸元素（占 2 份）
                    Rectangle {
                        height: 100px;
                        background: var(--warning-color);
                        border-radius: var(--radius-medium);
                        // 占用剩余空间的 2/(1+2) = 2/3
                        stretch: 2;

                        Text {
                            text: "拉伸因子 2";
                            color: white;
                            font-size: 12px;
                            vertical-alignment: center;
                            horizontal-alignment: center;
                        }
                    }
                }
            }

            // ================================================================
            // 垂直布局演示
            // ================================================================
            // else if: 条件渲染的链式语法（Slint 0.x）
            else if active-tab == 1: {
                VerticalLayout {
                    spacing: var(--spacing-medium);
                    padding: var(--spacing-medium);

                    // 固定高度
                    Rectangle {
                        width: 150px;
                        height: 80px;         // 固定高度
                        background: var(--primary-color);
                        border-radius: var(--radius-medium);

                        Text {
                            text: "固定高度";
                            color: white;
                            font-size: 12px;
                            vertical-alignment: center;
                            horizontal-alignment: center;
                        }
                    }

                    // 垂直拉伸
                    Rectangle {
                        width: 150px;
                        background: var(--secondary-color);
                        border-radius: var(--radius-medium);
                        stretch: 1;           // 垂直方向拉伸

                        Text {
                            text: "拉伸因子 1";
                            color: white;
                            font-size: 12px;
                            vertical-alignment: center;
                            horizontal-alignment: center;
                        }
                    }

                    Rectangle {
                        width: 150px;
                        background: var(--warning-color);
                        border-radius: var(--radius-medium);
                        stretch: 2;

                        Text {
                            text: "拉伸因子 2";
                            color: white;
                            font-size: 12px;
                            vertical-alignment: center;
                            horizontal-alignment: center;
                        }
                    }
                }
            }

            // ================================================================
            // 网格布局演示
            // ================================================================
            // GridLayout: 网格排列子元素
            //
            // 【关键属性】
            // - columns: 列数
            // - spacing: 单元格间距
            // - 子元素按顺序填充网格
            else if active-tab == 2: {
                GridLayout {
                    spacing: var(--spacing-small);
                    padding: var(--spacing-medium);
                    columns: 3;               // 3 列网格

                    // 使用 for 循环生成 9 个单元格（3x3）
                    for i in 0..9: {
                        Rectangle {
                            width: 80px;
                            height: 80px;
                            // 调用函数根据索引返回颜色
                            background: grid_color(i);
                            border-radius: var(--radius-medium);

                            Text {
                                // 显示序号（1-9）
                                text: (i + 1);
                                color: white;
                                font-size: 18px;
                                vertical-alignment: center;
                                horizontal-alignment: center;
                            }
                        }
                    }
                }
            }

            // ================================================================
            // 堆叠布局演示
            // ================================================================
            // StackLayout: 元素堆叠（后者覆盖前者）
            //
            // 【注意】
            // 这是 Slint 0.x 概念
            // Slint 1.x 中直接使用 Rectangle 嵌套
            // 或使用绝对定位 (x, y 属性)
            else if active-tab == 3: {
                StackLayout {
                    width: 200px;
                    height: 200px;

                    // 背景层（最底层）
                    Rectangle {
                        width: 100%;
                        height: 100%;
                        background: var(--primary-color);
                        border-radius: var(--radius-medium);
                    }

                    // 中间层
                    Rectangle {
                        x: 50px;              // 绝对定位 X
                        y: 50px;              // 绝对定位 Y
                        width: 100px;
                        height: 100px;
                        background: var(--secondary-color);
                        border-radius: var(--radius-medium);
                    }

                    // 顶层
                    Rectangle {
                        x: 75px;
                        y: 75px;
                        width: 50px;
                        height: 50px;
                        background: var(--warning-color);
                        border-radius: var(--radius-medium);
                    }

                    // 文本覆盖在最上层
                    Text {
                        text: "堆叠布局";
                        color: white;
                        font-size: 16px;
                        font-weight: bold;
                        vertical-alignment: center;
                        horizontal-alignment: center;
                        // z-index: 控制堆叠顺序
                        z-index: 10;
                    }
                }
            }

            // ================================================================
            // 样式演示
            // ================================================================
            else if active-tab == 4: {
                VerticalLayout {
                    spacing: var(--spacing-medium);
                    padding: var(--spacing-medium);

                    // 边框样式
                    Rectangle {
                        width: 100px;
                        height: 60px;
                        background: var(--bg-color);
                        // border: 简写属性
                        border: 2px solid var(--primary-color);
                        // border-radius: 圆角
                        border-radius: var(--radius-medium);

                        Text {
                            text: "边框样式";
                            color: var(--text-color);
                            font-size: 12px;
                            vertical-alignment: center;
                            horizontal-alignment: center;
                        }
                    }

                    // 阴影效果
                    Rectangle {
                        width: 100px;
                        height: 60px;
                        background: var(--bg-color);
                        border-radius: var(--radius-medium);
                        // 阴影属性
                        shadow-offset-y: 4px;   // Y 偏移
                        shadow-blur: 12px;      // 模糊半径
                        shadow-color: rgba(0, 0, 0, 0.2);  // 阴影颜色

                        Text {
                            text: "阴影效果";
                            color: var(--text-color);
                            font-size: 12px;
                            vertical-alignment: center;
                            horizontal-alignment: center;
                        }
                    }

                    // 渐变背景（Slint 0.x 语法）
                    Rectangle {
                        width: 100px;
                        height: 60px;
                        // linear-gradient: 线性渐变
                        background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
                        border-radius: var(--radius-medium);

                        Text {
                            text: "渐变背景";
                            color: white;
                            font-size: 12px;
                            vertical-alignment: center;
                            horizontal-alignment: center;
                        }
                    }

                    // 文本样式
                    Text {
                        text: "文本样式演示";
                        font-size: 18px;
                        font-weight: bold;     // 粗体
                        font-style: italic;    // 斜体
                        color: var(--primary-color);
                        text-decoration: underline;  // 下划线
                    }
                }
            }
        }

        // 响应式设计说明
        Text {
            text: "响应式设计：使用拉伸因子、最小/最大尺寸和变量实现自适应布局";
            font-size: 12px;
            color: var(--text-light);
            horizontal-alignment: center;
            word-wrap: true;
            width: 100%;
        }
    }

    // 根据索引返回颜色
    function grid_color(index) -> color {
        if index < 3 {
            return var(--primary-color);
        } else if index < 6 {
            return var(--secondary-color);
        } else {
            return var(--warning-color);
        }
    }
}

// ============================================================================
// 【知识点总结】
// ============================================================================
//
// 1. 布局容器
//    VerticalLayout   - 垂直排列
//    HorizontalLayout - 水平排列
//    GridLayout       - 网格布局
//    StackLayout      - 堆叠布局
//
// 2. 布局属性
//    padding          - 内边距
//    spacing          - 子元素间距
//    alignment        - 对齐方式
//    stretch          - 拉伸因子
//
// 3. 尺寸约束
//    width, height     - 固定尺寸
//    min-width/height  - 最小尺寸
//    max-width/height  - 最大尺寸
//    %                 - 百分比
//
// 4. 样式属性
//    background        - 背景
//    border            - 边框
//    border-radius     - 圆角
//    shadow-*          - 阴影
//    color             - 文本颜色
//    font-*            - 字体属性
//
// 5. 全局变量
//    @global-styles    - 0.x 语法
//    global Component  - 1.x 推荐
//    var(--name)       - 引用变量
//
// 6. 条件渲染
//    if condition: { }
//    else if condition: { }
//
// 7. 与 Rust 的关系
//    布局/样式不直接生成 API
//    通过属性动态控制样式
//    如：theme 属性控制颜色
// ============================================================================
