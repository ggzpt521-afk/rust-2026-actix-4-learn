// ============================================================================
// 08_cross_platform.slint - Slint è·¨å¹³å°æ„å»ºç¤ºä¾‹
// ============================================================================
//
// ã€æ–‡ä»¶è¯´æ˜ã€‘
// æœ¬æ–‡ä»¶æ¼”ç¤º Slint çš„è·¨å¹³å°ç‰¹æ€§
// Slint æ”¯æŒ Windowsã€macOSã€Linux åŠåµŒå…¥å¼å¹³å°
//
// ã€ä¸ .rs æ–‡ä»¶çš„å…³è”ã€‘
// - å¹³å°æ£€æµ‹é€»è¾‘åœ¨ Rust ä¸­å®ç°
// - ä½¿ç”¨æ¡ä»¶ç¼–è¯‘ #[cfg()] å¤„ç†å¹³å°å·®å¼‚
// - ç³»ç»Ÿä¿¡æ¯é€šè¿‡å±æ€§ä¼ é€’ç»™ UI
// - callback å¯ç”¨äºè§¦å‘å¹³å°ç‰¹å®šåŠŸèƒ½
//
// ã€è·¨å¹³å°åŸç†ã€‘
// 1. Rust + Slint ç¼–è¯‘ä¸ºåŸç”ŸäºŒè¿›åˆ¶
// 2. æ¸²æŸ“åç«¯å¯é€‰ï¼šOpenGLã€Skiaã€è½¯ä»¶æ¸²æŸ“
// 3. çª—å£ç®¡ç†ä½¿ç”¨ winitï¼ˆè·¨å¹³å°çª—å£æŠ½è±¡ï¼‰
// 4. UI å®šä¹‰å®Œå…¨å¹³å°æ— å…³
//
// ã€è·¨å¹³å°æ„å»ºæµç¨‹ã€‘
// 1. cargo build --target x86_64-pc-windows-msvc    # Windows
// 2. cargo build --target x86_64-unknown-linux-gnu  # Linux
// 3. cargo build --target x86_64-apple-darwin       # macOS Intel
// 4. cargo build --target aarch64-apple-darwin      # macOS Apple Silicon
// ============================================================================

// ============================================================================
// å…¨å±€æ ·å¼å˜é‡
// ============================================================================
// å®šä¹‰å¹³å°æ— å…³çš„æ ·å¼å˜é‡
// è¿™äº›å˜é‡åœ¨æ‰€æœ‰å¹³å°ä¸Šä½¿ç”¨ç›¸åŒçš„å€¼
@global-styles {
    // é€šç”¨æ ·å¼å˜é‡
    --primary-color: #0066cc;
    --text-color: #333333;
    --bg-color: #ffffff;
    --border-color: #e0e0e0;

    // å¹³å°ç‰¹å®šå˜é‡ï¼ˆå¯ç”± Rust è¦†ç›–ï¼‰
    --platform-name: "æœªçŸ¥å¹³å°";
    --platform-icon: "ğŸ“±";
}

// ============================================================================
// ä¸»åº”ç”¨ç»„ä»¶
// ============================================================================
export component CrossPlatform {
    width: 400px;
    height: 350px;

    // ========================================================================
    // å¹³å°ä¿¡æ¯å±æ€§
    // ========================================================================
    // è¿™äº›å±æ€§ç”± Rust ä»£ç åœ¨è¿è¡Œæ—¶è®¾ç½®
    // å±•ç¤ºäº† .slint å’Œ .rs ä¹‹é—´çš„æ•°æ®ä¼ é€’
    //
    // ã€Rust è®¾ç½®ç¤ºä¾‹ã€‘
    // let os_type = sys_info::os_type().unwrap();
    // app.set_platform_name(match os_type.as_str() {
    //     "Darwin" => "macOS",
    //     "Linux" => "Linux",
    //     "Windows_NT" => "Windows",
    //     _ => "æœªçŸ¥",
    // }.into());
    //
    // ã€in propertyã€‘
    // ç”± Rust è®¾ç½®ï¼ŒUI åªè¯»
    // é€‚åˆä¼ é€’ç³»ç»Ÿä¿¡æ¯ã€é…ç½®ç­‰
    in property <string> platform-name: "";    // å¹³å°åç§°
    in property <string> platform-icon: "";    // å¹³å°å›¾æ ‡ï¼ˆemojiï¼‰
    in property <string> os-version: "";       // ç³»ç»Ÿç‰ˆæœ¬
    in property <string> architecture: "";     // CPU æ¶æ„

    VerticalLayout {
        padding: 20px;
        spacing: 15px;

        // ====================================================================
        // æ ‡é¢˜åŒºåŸŸ
        // ====================================================================
        // æ˜¾ç¤ºå¹³å°å›¾æ ‡å’Œæ ‡é¢˜
        HorizontalLayout {
            spacing: 10px;
            alignment: center;
            vertical-alignment: center;

            // å¹³å°å›¾æ ‡ï¼ˆç”± Rust è®¾ç½®ï¼‰
            Text {
                text: platform-icon;
                font-size: 32px;
            }

            Text {
                text: "è·¨å¹³å°æ„å»ºç¤ºä¾‹";
                font-size: 24px;
                font-weight: bold;
                color: var(--text-color);
            }
        }

        // ====================================================================
        // å¹³å°ä¿¡æ¯å¡ç‰‡
        // ====================================================================
        // æ˜¾ç¤ºä» Rust è·å–çš„ç³»ç»Ÿä¿¡æ¯
        Rectangle {
            width: 100%;
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;

            VerticalLayout {
                spacing: 10px;

                // å¹³å°åç§°
                HorizontalLayout {
                    spacing: 10px;

                    Text {
                        text: "å¹³å°:";
                        font-weight: bold;
                        color: var(--text-color);
                        width: 80px;
                    }

                    // ç»‘å®šåˆ° Rust è®¾ç½®çš„å±æ€§
                    Text {
                        text: platform-name;
                        color: var(--primary-color);
                    }
                }

                // ç³»ç»Ÿç‰ˆæœ¬
                HorizontalLayout {
                    spacing: 10px;

                    Text {
                        text: "ç‰ˆæœ¬:";
                        font-weight: bold;
                        color: var(--text-color);
                        width: 80px;
                    }

                    Text {
                        text: os-version;
                        color: var(--text-color);
                    }
                }

                // CPU æ¶æ„
                HorizontalLayout {
                    spacing: 10px;

                    Text {
                        text: "æ¶æ„:";
                        font-weight: bold;
                        color: var(--text-color);
                        width: 80px;
                    }

                    Text {
                        text: architecture;
                        color: var(--text-color);
                    }
                }
            }
        }

        // ====================================================================
        // è·¨å¹³å°åŠŸèƒ½è¯´æ˜
        // ====================================================================
        Rectangle {
            width: 100%;
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;

            // å¤šè¡Œæ–‡æœ¬ä½¿ç”¨ \n æˆ– \ ç»­è¡Œ
            Text {
                text: "è·¨å¹³å°ç‰¹æ€§:  \
â€¢ è‡ªåŠ¨é€‚åº”ä¸åŒæ“ä½œç³»ç»Ÿ  \
â€¢ ç»Ÿä¸€çš„ä»£ç åº“  \
â€¢ åŸç”Ÿæ€§èƒ½ä½“éªŒ  \
â€¢ æ”¯æŒ Windowsã€macOSã€Linux  \
â€¢ å¯æ‰“åŒ…ä¸ºç‹¬ç«‹åº”ç”¨";
                font-size: 14px;
                color: var(--text-color);
                line-height: 1.5;
            }
        }

        // ====================================================================
        // æ„å»ºè¯´æ˜æŒ‰é’®
        // ====================================================================
        // ç‚¹å‡»æŒ‰é’®è§¦å‘ callbackï¼Œç”± Rust å¤„ç†
        Button {
            text: "æŸ¥çœ‹æ„å»ºè¯´æ˜";
            alignment: center;
            background: var(--primary-color);
            color: white;
            border-radius: 8px;

            on-clicked: {
                // è°ƒç”¨å›è°ƒï¼Œç”± Rust å¤„ç†
                // å¯ä»¥æ‰“å¼€å¯¹è¯æ¡†ã€æ˜¾ç¤ºå¸®åŠ©ç­‰
                show-build-instructions();
            }
        }
    }

    // ========================================================================
    // å¯¹è¯æ¡†å®šä¹‰ï¼ˆSlint 0.x è¯­æ³•ï¼‰
    // ========================================================================
    // dialog: å®šä¹‰æ¨¡æ€å¯¹è¯æ¡†
    //
    // ã€æ³¨æ„ã€‘
    // è¿™æ˜¯ Slint 0.x çš„è¯­æ³•
    // Slint 1.x æ¨èä½¿ç”¨ PopupWindow æˆ–è‡ªå®šä¹‰ç»„ä»¶
    //
    // ã€ä½¿ç”¨æ–¹å¼ã€‘
    // 1. å®šä¹‰ dialog
    // 2. é€šè¿‡ callback æˆ–å±æ€§æ§åˆ¶æ˜¾ç¤º
    dialog BuildInstructions {
        width: 350px;
        height: 250px;
        title: "æ„å»ºè¯´æ˜";

        VerticalLayout {
            padding: 20px;
            spacing: 10px;

            Text {
                text: "è·¨å¹³å°æ„å»ºå‘½ä»¤:";
                font-weight: bold;
                color: var(--text-color);
            }

            // ä»£ç å—æ˜¾ç¤º
            ScrollView {
                width: 100%;
                height: 150px;
                border: 1px solid var(--border-color);

                Text {
                    // å¤šè¡Œå­—ç¬¦ä¸²ä½¿ç”¨ + æ‹¼æ¥
                    text: "# å¼€å‘æ„å»º\n"
                         + "cargo run --bin 08_cross_platform\n\n"
                         + "# å‘å¸ƒæ„å»º\n"
                         + "cargo build --release --bin 08_cross_platform\n\n"
                         + "# è·¨å¹³å°äº¤å‰ç¼–è¯‘\n"
                         + "# Windows\n"
                         + "cargo build --target x86_64-pc-windows-msvc --release\n\n"
                         + "# Linux\n"
                         + "cargo build --target x86_64-unknown-linux-gnu --release\n\n"
                         + "# macOS\n"
                         + "cargo build --target x86_64-apple-darwin --release\n"
                         + "cargo build --target aarch64-apple-darwin --release";
                    font-family: monospace;  // ç­‰å®½å­—ä½“
                    font-size: 12px;
                    color: var(--text-color);
                    padding: 10px;
                    white-space: pre;        // ä¿ç•™ç©ºç™½å’Œæ¢è¡Œ
                }
            }

            Button {
                text: "å…³é—­";
                alignment: center;
                on-clicked: {
                    close();  // å…³é—­å¯¹è¯æ¡†
                }
            }
        }
    }

    // ========================================================================
    // å›è°ƒå£°æ˜
    // ========================================================================
    // è¿™ä¸ªå›è°ƒç”± Rust å®ç°
    // ç”¨äºå¤„ç†"æŸ¥çœ‹æ„å»ºè¯´æ˜"æŒ‰é’®ç‚¹å‡»
    //
    // ã€Rust å®ç°ç¤ºä¾‹ã€‘
    // app.on_show_build_instructions(|| {
    //     // æ˜¾ç¤ºå¯¹è¯æ¡†æˆ–æ‰“å¼€å¸®åŠ©æ–‡æ¡£
    //     println!("æ˜¾ç¤ºæ„å»ºè¯´æ˜");
    // });
    callback show-build-instructions();
}

// ============================================================================
// ã€çŸ¥è¯†ç‚¹æ€»ç»“ã€‘
// ============================================================================
//
// 1. è·¨å¹³å°æ”¯æŒ
//    - Windows (x86_64-pc-windows-msvc)
//    - Linux (x86_64-unknown-linux-gnu)
//    - macOS Intel (x86_64-apple-darwin)
//    - macOS Apple Silicon (aarch64-apple-darwin)
//    - åµŒå…¥å¼ï¼ˆARM ç­‰ï¼‰
//
// 2. Rust æ¡ä»¶ç¼–è¯‘
//    #[cfg(target_os = "windows")]
//    #[cfg(target_os = "linux")]
//    #[cfg(target_os = "macos")]
//    #[cfg(target_arch = "x86_64")]
//    #[cfg(target_arch = "aarch64")]
//
// 3. ç³»ç»Ÿä¿¡æ¯è·å–
//    sys-info crate: os_type(), os_release()
//    std::env::consts: OS, ARCH
//    ç¼–è¯‘æ—¶å¸¸é‡ vs è¿è¡Œæ—¶æ£€æµ‹
//
// 4. æ¸²æŸ“åç«¯
//    femtovg (OpenGL) - é»˜è®¤
//    skia - Google 2D å›¾å½¢åº“
//    software - çº¯è½¯ä»¶æ¸²æŸ“
//
// 5. å±æ€§ä¼ é€’
//    Rust â†’ UI: in property
//    ç”¨äºä¼ é€’ç³»ç»Ÿä¿¡æ¯ã€é…ç½®ç­‰
//    app.set_property_name(value)
//
// 6. å¯¹è¯æ¡†
//    Slint 0.x: dialog { }
//    Slint 1.x: PopupWindow æˆ–è‡ªå®šä¹‰ç»„ä»¶
//
// 7. æ‰“åŒ…å‘å¸ƒ
//    Windows: .exe / MSIX
//    macOS: .app / DMG
//    Linux: AppImage / Flatpak / DEB / RPM
//
// 8. ä¸ .rs çš„å…³ç³»
//    .slint: å¹³å°æ— å…³çš„ UI å®šä¹‰
//    .rs:    å¹³å°ç‰¹å®šé€»è¾‘ï¼ˆæ¡ä»¶ç¼–è¯‘ï¼‰
//    æ¡¥æ¢:   property ä¼ é€’å¹³å°ä¿¡æ¯
// ============================================================================
